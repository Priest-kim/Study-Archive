# 리팩토링

## Problem-007: 게시판 권한 관리 시스템

작업일자: 2025-01-19

## 원본 코드의 문제점

1. 단일 책임 원칙 위반
2. 조건문 중첩이 깊음
3. 에러 메시지 관리가 분산되어 있음
4. 권한 규칙의 우선순위가 명확하지 않음

## 개선 방향

1. 각 타입(게시글/댓글)별 권한 검사 로직 분리
2. 권한 규칙을 설정으로 분리
3. 에러 메시지 중앙 관리
4. 권한 검사 순서 명확화
5. 새로운 규칙 추가가 용이한 구조 설계

## 적용한 설계원칙과 패턴

### 1. 상수 분리

- 에러 메시지를 ERROR_MESSAGE 상수로 분리하여 중앙 관리
- 각 리소스별 권한 전략을 ROLE_POST_STRATEGY, ROLE_COMMENT_STRATEGY로 분리

### 2. 전략 패턴을 사용하여 로직 분리

- 역할(Role) 기반으로 전략을 분리하여 권한 관리를 명확히 함
- 각 역할별로 allowedActions와 validateCondition을 정의
- context 객체를 사용하여 파라미터 전달을 일관되게 처리

### 3. 단일 책임 원칙 적용

- 게시글과 댓글의 권한 검증 로직을 별도로 분리
- 각 역할별 검증 로직을 독립적으로 관리

## 개선된 점

### 1. 코드의 가독성 향상

- 중첩된 조건문을 전략 패턴으로 해결
- 역할별 권한 관리가 명확해짐

### 2. 유지보수성 향상

- 새로운 역할이나 권한 규칙 추가가 용이
- 에러 메시지 관리가 중앙화됨

### 3. 확장성 개선

- 새로운 리소스 타입 추가가 쉬워짐
- 권한 검증 로직 수정이 독립적으로 가능

## 아쉬운 점

1. ADMIN, GUEST 등 공통 로직이 POST/COMMENT에서 중복됨
2. resource 타입에 따른 전략 선택 로직이 명시적이지 않음
3. 일부 반환 값의 일관성이 부족함

## 배운 점

1. 전략 패턴을 통한 조건문 리팩토링 방법
2. 역할 기반의 권한 관리 구조 설계 방법
3. 상수 분리를 통한 중앙화된 메시지 관리의 중요성

## 느낀 점

> 이번 리팩토링을 작업하면서 전략 패턴에 대한 나만의 기준이 생긴 것 같다.
> 좀 더 연습해봐야 겠지만.
